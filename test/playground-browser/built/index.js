!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){const i=n(1),s=n(8);console.log("-- Playground Mode --"),new class{constructor(){this.onKeypress=this.onKeypress.bind(this),this.onKeybinding=this.onKeybinding.bind(this),window.addEventListener("keydown",this.onKeypress),this.keybinder=new i(s,this.onKeybinding,{getKeybinding:(t,e)=>e.get(t.key),isKeyNumber:t=>/\d/.test(t.key),isKeyEscape:t=>"Escape"===t.key}),this.div=document.querySelector("#console"),document.querySelector("#clear").addEventListener("click",()=>this.clear())}onKeypress(t){this.keybinder.handleKey(t),"k"===t.key&&t.metaKey&&this.clear()}onKeybinding(t,e,n){const i=this.div.scrollHeight-this.div.offsetHeight===this.div.scrollTop;this.div.append(document.createElement("hr"));const s=document.createElement("pre"),r="keybinding"===t?this.formatKb(e):e;s.textContent=`"${t}" -- ${r}`,this.div.append(s),i&&this.div.scrollTo(0,this.div.scrollHeight)}clear(){this.div.innerHTML=""}formatKb(t){return JSON.stringify({keys:t.keys.map(t=>t.toString()),count:t.count,action:t.action,store:t.store},null,2)}}},function(t,e,n){t.exports=n(2)},function(t,e,n){const i=n(3);n(7);t.exports=class{static handleKeys(t,...e){const n=new this(...e);t.forEach(t=>n.handleKey(t))}constructor(t,e,n){this.originalMap=t||new Map,this.map=new Map([...this.originalMap]),this.interpreter=new i(this.map,e,n)}handleKey(t){return this.interpreter.handleKey(t)}handleKeys(t,e){return this.constructor.handleKeys(t,new Map([...this.originalMap]),e)}destroy(){this.interpreter.destroy(),this.interpreter=null,this.map.clear(),this.map=this.originalMap=null}}},function(t,e,n){const i=n(4),s=n(5),r=n(6),o={getKeybinding:(t,e)=>e.get(t),isKeyNumber:t=>/\d/.test(t),isKeyEscape:t=>"escape"===t},h={WAITING:1,IS_READING:2,IS_INTERPRETING:3,NEEDS_KEY:4,DONE:5};class a{static get STATUS(){return h}constructor(t,e,n={}){this.map=t,this.doneCb=e,this.options={...o,...n},this.read=this.read.bind(this),this.interpret=this.interpret.bind(this),this.done=this.done.bind(this),this.kb=new i({store:this.options.store||{}}),this.cds=[{action:null}],this.keyReader=this.interpreter=null,this.status=this.STATUS.WAITING}get STATUS(){return this.constructor.STATUS}reset(){this.cdToRoot(),this.status=this.STATUS.WAITING,this.kb=new i}handleKey(t){return this.options.isKeyEscape(t)?this.onDone("cancel"):this.status===this.STATUS.NEEDS_KEY?this.onNeededKey(t):(this.kb.keys.push(t),void(this.status===this.STATUS.WAITING?this.onWaiting(t):this.status===this.STATUS.IS_READING?this.keyReader.handleKey(t):this.status===this.STATUS.IS_INTERPRETING&&this.interpreter.handleKey(t)))}onWaiting(t){const e=this.options.getKeybinding(t,this.map);!this.options.isKeyNumber(t)||0===this.kb.countChars.length&&e?e?this.options.filter&&this.options.filter(e)?this.onFiltered(e):e.keybindings instanceof Map&&"function"==typeof e.behavior?this.onNeedsKey(e):e.keybindings instanceof Map?this.onKeybindingMap(e):"function"==typeof e.behavior?this.onBehavior(e):this.onDone("keybinding",e):this.onUnrecognized(t):this.onNumber(t)}onNumber(t){this.kb.countChars.push(t)}onUnrecognized(t){this.onDone("unrecognized",t)}onFiltered(t){this.onDone("filtered",t)}onNeedsKey(t){this.status=this.STATUS.NEEDS_KEY,this.cdIntoAction(t)}onNeededKey(t){const e=this.getCurrentAction();e.keybindings instanceof Map&&e.keybindings.has(t)?this.onKeybindingMap(e):"function"==typeof e.behavior&&this.onBehavior(e),this.handleKey(t)}onKeybindingMap(t){this.status=this.STATUS.WAITING,this.cdIntoAction(t)}onBehavior(t){this.status=this.STATUS.WAITING,this.cdIntoAction(t);const{read:e,interpret:n,done:i}=this;t.behavior({read:e,interpret:n,done:i},this.kb)}read(t,e){this.status=this.STATUS.IS_READING,this.keyReader=new s(t,t=>{this.status=this.STATUS.WAITING,this.keyReader.destroy(),this.keyReader=null,e(t)})}interpret(t,e){this.status=this.STATUS.IS_INTERPRETING;const{store:n}=this.kb;this.interpreter=new a(this.map,(...e)=>{this.status=this.STATUS.WAITING,this.interpreter.cdToRoot(),this.interpreter.destroy(),this.interpreter=null,t(...e)},{...this.options,store:n,filter:e})}done(t="keybinding",e=this.getCurrentAction(),n){n=n||{resume:this.STATUS.WAITING}[t],this.onDone(t,e,n)}onDone(t,e,n=this.STATUS.DONE){this.status=n,"keybinding"===t&&(this.kb.action=e,e=this.kb),this.status===this.STATUS.DONE&&(this.doneCb(t,e,this.status),this.reset())}cdIntoAction(t){if(this.getCurrentAction()===t)return;const e=["interprets","keybindings"].map(e=>t[e]).filter(t=>t instanceof Map),[n,i]=r(this.map,...e);e.forEach(t=>t.forEach((t,e)=>this.map.set(e,t))),this.cds.push({action:t,replaced:n,added:i})}getCurrentAction(){return this.cds[this.cds.length-1].action}cdUp(){const{action:t,replaced:e,added:n}=this.cds.pop();e.forEach((t,e)=>this.map.set(e,t)),n.forEach((t,e)=>this.map.delete(e)),e.clear(),n.clear()}cdToRoot(){for(;this.cds.length>1;)this.cdUp()}destroy(){this.keyReader&&this.keyReader.destroy(),this.interpreter&&this.interpreter.cdToRoot(),this.interpreter&&this.interpreter.destroy(),this.map=this.store=this.doneCb=this.filter=null,this.kb=null,this.keyReader=this.interpreter=null}}t.exports=a},function(t,e){t.exports=class{constructor(t={}){this.keys=t.keys||[],this.countChars=t.countChars||[],this.action=t.action,this.store=t.store||{}}get count(){return 0===this.countChars.length?1:parseInt(this.countChars.join(""))}}},function(t,e){t.exports=class{constructor(t,e){this.count=t,this.doneCb=e,this.keys=[]}reset(t=this.count){this.count=t,this.keys=[]}handleKey(t){this.keys.push(t),this.keys.length===this.count&&this.doneCb(this.keys)}destroy(){this.count=this.doneCb=this.keys=null}}},function(t,e){t.exports=(t,...e)=>{const n=new Map,i=new Map;return e.forEach(e=>{for(const[s,r]of e.entries())t.has(s)?n.set(s,t.get(s)):i.set(s,r)}),[n,i]}},function(t,e){const n=new Set(["return","tab","space","backspace","enter","up","down","left","right"]),i=new Set(["escape","return","tab","backspace","up","down","left","right"]);t.exports={getKeyName(t,e){let i=t;return(n.has(e.name)||e.ctrl||e.meta)&&(i=e.name),i},toString(t,e){const n=[],s=this.getKeyName(t,e);return n.push(s),e.ctrl&&n.unshift("ctrl"),e.meta&&"escape"!==s&&n.unshift("meta"),e.shift&&i.has(e.name)&&n.unshift("shift"),n.join("+")}}},function(t,e){t.exports=new Map([["escape",{behavior:({done:t})=>t("cancel")}],["t",{name:"test"}],["f",{name:"find",type:"motion",behavior:({read:t,done:e},n)=>{t(1,t=>{n.store.find=t[0],e()})}}],["d",{name:"delete",keybindings:new Map([["d",{name:"delete-line"}],["z",{name:"i-take-priority"}]]),behavior:({interpret:t,done:e},n)=>{t((t,i,s)=>{if("keybinding"!==t)return e("cancel");n.store[i.action.type]=n.name,e()},t=>!["textObject","motion"].includes(t.type))},interprets:new Map([["z",{name:"i-dont-take-priority"}],["i",{name:"inner",type:"textObject",behavior:({read:t,done:e},n)=>{t(1,t=>{n.store.inner=t[0],e()})}}],["[",{name:"i-am-not-root"}]])}],["y",{name:"yank",keybindings:new Map([["y",{name:"yank-line"}],["z",{name:"zzzzzzzzzzzz"}]])}],["i",{name:"insert"}],["j",{name:"cursor-down",type:"motion"}],["0",{name:"cursor-to-start",type:"motion"}],['"',{name:"register",behavior:({read:t,done:e},n)=>{t(1,t=>{n.store.register=t[0],e("resume")})}}],["z",{name:"nested-supplemental",behavior:({read:t,done:e},n)=>{t(1,t=>{n.store.z=t[0],e("resume")})}}]])}]);